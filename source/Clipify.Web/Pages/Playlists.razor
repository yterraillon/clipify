@page "/playlists"
@using MediatR
@using Clipify.Application.Playlists.Models
@using Clipify.Application.Playlists.Requests.GetPlaylists
@using Clipify.Application.Playlists.Commands.SavePlaylist
@using Clipify.Web.Services

@inject PlaylistsService _playlistsService 

<h3>Playlists</h3>

<div class="container flex flex-wrap flex-auto">
    @foreach (var playlist in _playlists)
    {
        var currentPlaylist = playlist;

        <div class="max-w-sm m-3 rounded overflow-hidden shadow-lg">
            @if (playlist.Images.Any())
            {
                <img class="w-full" src="@playlist.Images.FirstOrDefault()?.Url" alt="Cover">
            }
            else
            {
                <img class="w-full" src="https://via.placeholder.com/384" alt="Cover"/>
            }
            <div class="px-6 py-4">
                <div class="font-bold text-xl mb-2 text-center h-12 min-h-full">@playlist.Name</div>
                <div class="text-sm py-3 text-gray-500 h-20 min-h-full">@((MarkupString) playlist.Description)</div>
            </div>
            <div class="flex justify-center items-center my-2">
                
                <button class="px-5 py-2 mr-2 uppercase text-white font-medium rounded-3xl bg-green-500 shadow-md"
                        @onclick="@(() => SavePlaylistAsync(currentPlaylist))">
                    Save Playlist
                </button>
                <NavLink href="@("Playlist/" + playlist.Id)" Match="NavLinkMatch.Prefix" class="px-5 py-2 uppercase text-gray-900 font-medium rounded-3xl border border-green-500">
                    Info
                </NavLink>
            </div>
            

        </div>
    }
</div>

@code
{
    private IEnumerable<PlaylistViewModel> _playlists = Enumerable.Empty<PlaylistViewModel>();

    protected override async Task OnInitializedAsync()
    {
        _playlists = await _playlistsService.GetPlaylists();
    }

    private Task SavePlaylistAsync(PlaylistViewModel playlist)
        => _playlistsService.SavePlaylist(playlist.Id, playlist.SnapshotId, playlist.Name);
}
